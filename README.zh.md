[English](README.md) | **中文**

# 🎤 Wi-Fi Party

**把客厅变成 KTV 包厢**

想在家开 KTV 派对？不需要昂贵的设备——你的手机和电脑已经具备一切！只需连接同一个 Wi-Fi，打开应用，就能一起唱歌。

Wi-Fi Party 让局域网内的所有人实时共享音频。拿起麦克风，放上音乐，派对开始！

## ✨ 功能亮点

- **🎙️ 共享麦克风** — 对着手机或电脑唱歌，所有人即时听到
- **🔊 共享系统音频** — 播放伴奏？一键分享给全场
- **🎵 同步播放音乐** — 音乐文件在所有设备上完美同步播放
- **👥 即连即用** — 无需配置、无需账号，连上同一网络即可

## 🎯 为什么做这个

商用 KTV 系统动辄上万。蓝牙音箱延迟感人。投屏方案又卡又麻烦。

如果你现有的设备能直接互相通信呢？Wi-Fi Party 使用 UDP 组播，所有设备同时广播和接收音频，把任何局域网变成 KTV 包厢，延迟低到可以真正跟唱。

## ⚡ 为低延迟而生

实时音频很难做好，我们在每一毫秒上死磕：

- **无锁队列** — 音频路径零互斥锁竞争
- **3ms 音频缓冲** — cpal 允许的最小值
- **自适应抖动缓冲** — 平滑播放，不增加延迟
- **零拷贝序列化** — rkyv 处理网络包
- **DSCP/QoS 标记** — 音频流量网络优先级

## 🛠️ 技术栈

| 组件 | 技术 |
|------|------|
| 界面 | [Dioxus](https://dioxuslabs.com/) Desktop |
| 音频 | [cpal](https://github.com/RustAudio/cpal) + [Opus](https://opus-codec.org/) |
| 音乐解码 | [Symphonia](https://github.com/pdeljanov/Symphonia) (MP3, FLAC, OGG, WAV, AAC) |
| 网络 | UDP 组播 |
| 序列化 | [rkyv](https://github.com/rkyv/rkyv) |

## 🚀 快速开始

从 [Releases](#) 下载，或从源码构建（参见 [HACKING.md](HACKING.md)）。

在每台设备上启动应用，它们会自动在局域网内发现彼此。

## 🏗️ 工作原理

```
┌─────────────────────────────────────────────────────────────────┐
│                         Party (调度器)                           │
├─────────────────────────────────────────────────────────────────┤
│  麦克风管线          系统音频管线           音乐管线                 │
│  ┌──────────────┐   ┌──────────────┐      ┌──────────────┐      │
│  │ AudioInput   │   │ LoopbackInput│      │ MusicStreamer│      │
│  │ → LevelMeter │   │ → LevelMeter │      │ → Symphonia  │      │
│  │ → Gain       │   │ → Switch     │      │ → NTP 同步    │      │
│  │ → Switch     │   │ → Batcher    │      └──────────────┘      │
│  │ → Tee ───────│   │ → Opus       │                            │
│  │   ↓ 回放      │   │ → Network    │                            │
│  │   ↓ 网络      │   └──────────────┘                            │
│  └──────────────┘                                               │
├─────────────────────────────────────────────────────────────────┤
│                      网络层 (UDP 组播)                            │
│         IPv4: 239.255.43.2:7667  │  IPv6: ff02::7667:7667       │
├─────────────────────────────────────────────────────────────────┤
│  接收管线                                                        │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │ NetworkReceiver → JitterBuffer → OpusDecoder → Mixer → Out  ││
│  │                 → SyncedStream (NTP 调度播放) ↗              ││
│  └─────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────┘
```

## 📄 许可证

GPLv3
